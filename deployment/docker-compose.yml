version: '2'

services:
  db:
    container_name: igrac-mapstore-db
    image: kartoza/postgis:12.0
    volumes:
     - "./docker-mapstore/setup/db:/docker-entrypoint-initdb.d"
    environment:
     - POSTGRES_USER=postgres
     - POSTGRES_PASS=postgres
     - POSTGRES_DB=geostore
    # Uncomment to open ports
    #ports:
     #- '25432:5432'

  mapstore-backend:
    # use online mapstore image
    # to use locally compiled image, use
    # Dockerfile-backend
    container_name: igrac-mapstore-backend
    build:
     context: docker-mapstore
     dockerfile: Dockerfile-backend
    links:
     - db:db
    # Uncomment to open ports
    # ports:
     # - '8080:8080'

  mapstore-frontend:
    container_name: igrac-mapstore-frontend
    build: 
      context: docker-mapstore  
    environment:
      - REACT_APP_BACKEND=backend
    links:
      - mapstore-backend:backend
    # Uncomment to open ports
    # ports:
     # - '8081:8081'

  nginx:
    container_name: igrac-mapstore-nginx
    image: nginx
    hostname: nginx
    volumes:
      - ./sites-enabled:/etc/nginx/conf.d:ro
    links:
      - mapstore-frontend:frontend
    ports:
      - "80:8081"
      - "4430:443"
    restart: unless-stopped
